# Installation & Deployment Guide

## üìã Prerequisites

### Required Software
1. **.NET 6.0 Runtime or SDK**
   - Download from: https://dotnet.microsoft.com/download/dotnet/6.0
   - Choose either:
     - SDK (for development/building)
     - Runtime (for running pre-built executables)
   - Architecture: x64 (64-bit Windows)

2. **Windows Operating System**
   - Windows 10 (version 1809 or later)
   - Windows 11
   - Windows Server 2019/2022

3. **Nginx for Windows**
   - Download from: http://nginx.org/en/download.html
   - Choose: nginx/Windows-x.x.x (stable version)
   - Extract to: `[Application Directory]/nginx/`

4. **PHP for Windows**
   - Download from: https://windows.php.net/download/
   - Choose: Non-Thread Safe version (for FastCGI)
   - Architecture: x64
   - Extract to: `[Application Directory]/php/`

## üèóÔ∏è Building from Source

### Option 1: Using Build Script (Recommended)

1. **Open Command Prompt** in the project directory
2. **Run build script:**
   ```cmd
   build.bat
   ```
3. **Select build option:**
   - Option 2: Build Release Version (standard build)
   - Option 3: Build Single File (all-in-one executable)
4. **Wait for compilation** to complete
5. **Output location:**
   - Standard: `bin/Release/net6.0-windows/`
   - Single File: `published/`

### Option 2: Manual Build

```cmd
# Standard build
dotnet build DPOManager.csproj -c Release

# Single-file build
dotnet publish DPOManager.csproj -c Release -r win-x64 --self-contained false -p:PublishSingleFile=true -o published
```

## üì¶ Deployment Package Structure

### Standard Deployment
```
ProductionFolder/
‚îú‚îÄ‚îÄ DPOManager.exe                    (Main executable)
‚îú‚îÄ‚îÄ DPOManager.dll                    (Application library)
‚îú‚îÄ‚îÄ DPOManager.runtimeconfig.json     (Runtime configuration)
‚îú‚îÄ‚îÄ nginx/                            (Nginx directory)
‚îÇ   ‚îú‚îÄ‚îÄ nginx.exe                     (Nginx executable)
‚îÇ   ‚îú‚îÄ‚îÄ conf/                         (Config directory - auto-generated)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf                (Generated by app)
‚îÇ   ‚îú‚îÄ‚îÄ html/                         (Web root - auto-generated)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.php                 (Your PHP application)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manifesto/                (DPO application)
‚îÇ   ‚îú‚îÄ‚îÄ logs/                         (Nginx logs)
‚îÇ   ‚îî‚îÄ‚îÄ temp/                         (Nginx temp files)
‚îú‚îÄ‚îÄ php/                              (PHP directory)
‚îÇ   ‚îú‚îÄ‚îÄ php-cgi.exe                   (PHP FastCGI executable)
‚îÇ   ‚îú‚îÄ‚îÄ php.ini                       (PHP configuration)
‚îÇ   ‚îú‚îÄ‚îÄ ext/                          (PHP extensions)
‚îÇ   ‚îî‚îÄ‚îÄ (other PHP files)
‚îî‚îÄ‚îÄ logs/                             (Application logs - auto-generated)
    ‚îî‚îÄ‚îÄ DPO_*.log
```

### Single-File Deployment
```
ProductionFolder/
‚îú‚îÄ‚îÄ DPOManager.exe                    (All-in-one executable)
‚îú‚îÄ‚îÄ nginx/                            (Same as above)
‚îú‚îÄ‚îÄ php/                              (Same as above)
‚îî‚îÄ‚îÄ logs/                             (Auto-generated)
```

## üîß Step-by-Step Installation

### Step 1: Prepare Nginx

1. **Download Nginx:**
   ```
   http://nginx.org/download/nginx-1.24.0.zip
   ```

2. **Extract to project directory:**
   ```
   Extract nginx-1.24.0.zip
   Rename folder to: nginx
   Place in: [Application Directory]/nginx/
   ```

3. **Verify structure:**
   ```
   nginx/
   ‚îú‚îÄ‚îÄ nginx.exe
   ‚îú‚îÄ‚îÄ conf/
   ‚îú‚îÄ‚îÄ html/
   ‚îî‚îÄ‚îÄ logs/
   ```

4. **Copy your PHP application:**
   ```
   Copy your application files to: nginx/html/
   Ensure manifesto/ directory exists if needed
   ```

### Step 2: Prepare PHP

1. **Download PHP Non-Thread Safe:**
   ```
   https://windows.php.net/downloads/releases/php-8.2.x-nts-Win32-vs16-x64.zip
   ```

2. **Extract to project directory:**
   ```
   Extract php-8.2.x-nts-Win32-vs16-x64.zip
   Rename folder to: php
   Place in: [Application Directory]/php/
   ```

3. **Configure PHP:**
   ```
   Copy php.ini-production to php.ini
   Edit php.ini:
   
   ; Enable required extensions
   extension=mysqli
   extension=pdo_mysql
   extension=mbstring
   extension=openssl
   extension=curl
   
   ; Set upload limits
   upload_max_filesize = 100M
   post_max_size = 100M
   
   ; Set timezone
   date.timezone = Africa/Casablanca
   ```

4. **Verify structure:**
   ```
   php/
   ‚îú‚îÄ‚îÄ php-cgi.exe
   ‚îú‚îÄ‚îÄ php.ini
   ‚îî‚îÄ‚îÄ ext/
   ```

### Step 3: Deploy Application

1. **Copy built files:**
   ```cmd
   # From bin/Release/net6.0-windows/ to production folder
   copy DPOManager.exe [ProductionFolder]
   copy DPOManager.dll [ProductionFolder]
   copy DPOManager.runtimeconfig.json [ProductionFolder]
   ```

2. **Verify directory structure:**
   ```cmd
   dir [ProductionFolder]
   dir [ProductionFolder]\nginx
   dir [ProductionFolder]\php
   ```

### Step 4: First Run

1. **Right-click** `DPOManager.exe`
2. **Select** "Run as administrator"
3. **Allow** Windows Firewall if prompted
4. **Wait** for initialization
5. **Check** if all status indicators are ready

### Step 5: Configure Settings

1. **DPO Server:** Enter your server IP/hostname
2. **HTTP Port:** Set to 80 (or another available port)
3. **PHP Restart:** Keep default 240 minutes or adjust
4. **Auto-start:** Check if you want automatic startup

### Step 6: Start Servers

1. **Click** "Start Servers"
2. **Watch** progress bar and activity log
3. **Verify** green status indicators:
   - Nginx: ‚úì Running
   - PHP-CGI: ‚úì Running
4. **Check logs** if any issues

### Step 7: Test Application

1. **Click** "Open Browser"
2. **Verify** application loads correctly
3. **Test** PHP functionality
4. **Check** network connectivity with "Start Ping"

## üîê Security Configuration

### Administrator Privileges

**To require administrator privileges (recommended):**
- Keep `app.manifest` as-is
- Right-click ‚Üí Run as administrator

**To run without administrator:**
1. Edit `app.manifest`
2. Change:
   ```xml
   <requestedExecutionLevel level="requireAdministrator" uiAccess="false" />
   ```
   To:
   ```xml
   <requestedExecutionLevel level="asInvoker" uiAccess="false" />
   ```
3. Rebuild application

### Firewall Configuration

**Allow HTTP Port:**
```cmd
netsh advfirewall firewall add rule name="DPO HTTP" dir=in action=allow protocol=TCP localport=80
```

**Allow ICMP (for ping):**
```cmd
netsh advfirewall firewall add rule name="DPO Ping" dir=in action=allow protocol=icmpv4
```

## üöÄ Production Deployment

### Option A: Manual Startup

1. **Copy** all files to production machine
2. **Run** DPOManager.exe as administrator
3. **Configure** settings
4. **Start** servers

### Option B: Automatic Startup (Scheduled Task)

1. **Open** Task Scheduler
2. **Create** new task:
   - Name: DPO Server Manager
   - Run with highest privileges: ‚úì
   - Trigger: At startup
   - Action: Start `[Path]\DPOManager.exe`
3. **Enable** "Auto-start on launch" in application
4. **Test** by restarting computer

### Option C: Windows Service (Advanced)

For production environments, consider wrapping in a Windows Service using NSSM:

```cmd
# Download NSSM from: https://nssm.cc/download
nssm install DPOManager [Path]\DPOManager.exe
nssm set DPOManager AppDirectory [Path]
nssm set DPOManager DisplayName "DPO Server Manager"
nssm set DPOManager Description "Manages DPO production servers"
nssm set DPOManager Start SERVICE_AUTO_START
nssm start DPOManager
```

## üìä Monitoring & Maintenance

### Log Files

**Application logs:**
```
logs/DPO_YYYYMMDD_HHMMSS.log
```

**Nginx logs:**
```
nginx/logs/access.log
nginx/logs/error.log
```

**Log rotation (manual):**
```cmd
# Archive old logs monthly
move logs\DPO_202410*.log archive\
```

### Health Monitoring

1. **Check status indicators** in GUI
2. **Review activity log** regularly
3. **Monitor log files** for errors
4. **Test ping** to verify connectivity
5. **Verify PHP restarts** are successful

### Performance Tuning

**Adjust PHP restart interval:**
- High traffic: 120 minutes (2 hours)
- Medium traffic: 240 minutes (4 hours - default)
- Low traffic: 480 minutes (8 hours)

**Nginx configuration:**
- File is auto-generated
- Manual edits will be overwritten
- For custom changes, modify `GenerateNginxConfig()` method in code

## üêõ Troubleshooting Installation

### Issue: .NET Runtime Not Found

**Solution:**
```
1. Download .NET 6.0 Runtime from Microsoft
2. Install: windowsdesktop-runtime-6.0.x-win-x64.exe
3. Restart application
```

### Issue: nginx.exe Not Found

**Solution:**
```
1. Verify nginx directory exists
2. Check nginx.exe is present
3. Ensure correct path structure
4. Re-extract nginx if needed
```

### Issue: Port 80 Access Denied

**Solution:**
```
1. Run as administrator
2. Or change port to 8080
3. Check Windows firewall
4. Stop IIS if running (net stop w3svc)
```

### Issue: PHP Extensions Missing

**Solution:**
```
1. Check php.ini has correct extension paths
2. Verify extension DLLs exist in php/ext/
3. Enable required extensions in php.ini
4. Restart PHP-CGI
```

### Issue: Application Crashes on Startup

**Solution:**
```
1. Check logs/DPO_*.log for errors
2. Verify .NET 6.0 Runtime installed
3. Run as administrator
4. Check Windows Event Viewer
5. Verify all files copied correctly
```

## üìã Pre-Deployment Checklist

- [ ] .NET 6.0 Runtime installed
- [ ] Nginx extracted to correct location
- [ ] PHP extracted to correct location
- [ ] php.ini configured
- [ ] Application files copied
- [ ] DPO application files in nginx/html/
- [ ] Firewall configured
- [ ] Administrator privileges available
- [ ] Port 80 (or chosen port) available
- [ ] Tested on development machine
- [ ] Backup of previous version (if upgrading)
- [ ] Rollback plan prepared

## üîÑ Upgrading from Console Version

### Migration Steps

1. **Stop old application**
2. **Backup nginx/html/** (your PHP files)
3. **Note current configuration** (server, port, etc.)
4. **Deploy new GUI application**
5. **Copy PHP files back** to nginx/html/
6. **Configure settings** in GUI
7. **Test thoroughly**
8. **Keep old version** as backup

### Configuration Migration

**Old (command line):**
```cmd
Program.exe 10.142.0.204 80 240
```

**New (GUI):**
```
1. Launch DPOManager.exe
2. Set DPO Server: 10.142.0.204
3. Set HTTP Port: 80
4. Set PHP Restart: 240
5. Click Start Servers
```

## üìû Support & Resources

### Documentation Files
- `README.md` - Comprehensive feature documentation
- `QUICKSTART.md` - 5-minute getting started guide
- `FEATURES.md` - Detailed feature comparison
- `ARCHITECTURE.txt` - System architecture diagrams

### Common Resources
- .NET Download: https://dotnet.microsoft.com/download/dotnet/6.0
- Nginx Download: http://nginx.org/en/download.html
- PHP Download: https://windows.php.net/download/
- NSSM (Service Wrapper): https://nssm.cc/

### Troubleshooting Resources
1. Application activity log
2. Log files in logs/ directory
3. Nginx error logs
4. Windows Event Viewer
5. Task Manager (process monitoring)

---

**Note:** Always test deployments in a non-production environment first. Keep backups of configuration files and PHP applications before upgrading.
